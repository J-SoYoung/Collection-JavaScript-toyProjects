<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="./style.css">

</head>

<body>
  <div class="container">
    <button id="start_button">게임시작</button>
    <div id="game_container" style="display: none;">

      <div class="given_word_container">
        <div class="given_word">제시어 : <span id="word"></span></div>
        <div class="word_input_div">
          <input type="text" class="word_input" />
          <button id="word_enter_button">입력</button>
        </div>
      </div>

      <div id="participant_container">

        <!-- 곧 사라질놈 -->
      </div>
      <spna id="order">1</spna>번 참가자
    </div>
  </div>

  <script>
    const $start_button = document.querySelector('#start_button')
    const $game_container = document.querySelector('#game_container')
    const $order = document.querySelector('#order')
    const $word = document.querySelector('#word')
    const $input = document.querySelector('input')
    const $word_enter_button = document.querySelector('#word_enter_button')

    const $participant_container = document.querySelector('#participant_container')
    const $participant_ul = document.createElement('ul');
    const $participant_li = document.createElement('li');


    let number = 0
    let heart = 0
    let participant_list = []

    let order = 1
    let word = ''
    let newWord = ''

    const gameOver = () => {
      $game_container.style.display = 'none';
      $start_button.style.display = 'block';
    }

    const resetGameData = () => {
      order = 1;
      word = ''
      newWord = ''
      $order.textContent = order
      $input.value = "";
      $word.textContent = "";
    }

    const onClickGameStart = () => {
      number = Number(prompt('게임 참가자는 몇 명인가요?'))
      if (number < 1) {
        alert('최소 1명 이상은 있어야 게임이 시작됩니다.')
        return
      }
      const htmlStringArray = [];

      for (let i = 1; i <= number; i++) {
        // 참가자 노드 생성
        const userId = `userId_${i}`

        const participantHTML = `
          <div id="${userId}" class="participant">
            <p>참가자 ${i} - <span class="heart">♥♥♥</span></p>
          </div>
        `;
        htmlStringArray.push(participantHTML);
      }

      $participant_container.innerHTML = htmlStringArray.join(''); // 한 번에 추가

      $game_container.style.display = 'block';
      $start_button.style.display = 'none';

      // DOMParser를 통해 HTML을 파싱 + cloneNode node복제 =>  2975m.... 효율적이래매
      // const participantHTML = `
      //   <div id="${userId}" class="participant">
      //     <p>참가자 ${i} - <span class="heart">♥♥♥</span></p>
      //   </div>
      // `;
      // const parsedDocument = new DOMParser().parseFromString(participantHTML, 'text/html');
      // const fragment = parsedDocument.body.firstChild.cloneNode(true);
      // $participant_container.appendChild(fragment);


      // 일일이 노드 생성해서 넣음 [Violation] 'click' handler took 2401ms 
      // const $participant = document.createElement('div');
      // const $participant_p = document.createElement('p');
      // const $participant_span = document.createElement('span');

      // $participant.id = userId
      // $participant.className = 'participant'
      // $participant_p.textContent = `참가자 ${i} - `;
      // $participant_span.textContent = '♥'.repeat(3);
      // $participant_span.className = 'heart';

      // $participant_p.appendChild($participant_span)
      // $participant.appendChild($participant_p)
      // $participant_container.appendChild($participant)
      // // 생성된 user를 새로운 배열에 넣어줘야 한다. 

      $input.focus();
    }


    const onInput = (e) => {
      newWord = e.target.value;
    }

    const participant_user = () => {

    }

    const onClickButton = () => {
      if (newWord.length !== 3) {
        alert('3글자만 가능합니다')
        $input.value = "";
        $input.focus();
        return
      }

      if (!word || word[word.length - 1] === newWord[0]) {
        //단어를 옳게 작성했는가? 
        word = newWord;
        $word.textContent = newWord;
        $participant_li.textContent = newWord;
        // 참가자의 번호에 따른 다음 사람 순서
        if (order === number) {
          order = 1;
          $order.textContent = order;
        } else {
          order += 1;
          $order.textContent = order
        }
        const $game_progress_user = document.getElementById(order)
        $game_progress_user.style = 'border:1px solid'
        // for (let i = 1; i <= number) // 반복문 사용해서 id랑 order랑 안맞는 애들 display='none해주기'
        $input.value = "";
        $input.focus();
      } else {
        //단어를 옳게 작성하지 않았는가? 
        confirm('틀렸습니다. 게임을 다시 시작하겠습니까? ') ? onClickGameStart() : gameOver()
        resetGameData()
      }
    }

    $input.addEventListener('input', onInput)
    $start_button.addEventListener('click', onClickGameStart)
    $word_enter_button.addEventListener('click', onClickButton)


  </script>

</body>

</html>